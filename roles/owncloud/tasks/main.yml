# - name: configure owncloud
#   shell: wget https://raw.githubusercontent.com/yimingzenmedi/owncloud/master/owncloud_install.sh
- name: Add an apt key by id from a keyserver
  apt_key:
    url: https://download.owncloud.org/download/repositories/stable/Ubuntu_16.04/Release.key

# - name: download owncloud
#   shell: curl https://download.owncloud.org/download/repositories/stable/Ubuntu_16.04/Release.key | sudo apt-key add -
  
- name: configure owncloud
  shell: echo 'deb http://download.owncloud.org/download/repositories/stable/Ubuntu_16.04/ /' | sudo tee /etc/apt/sources.list.d/owncloud.list

- name: install owncloud-files
  apt:
    name: owncloud-files
    update_cache: yes
#     upgrade: yes
    
- name: copying template file
  copy:
    src: templates/apache
    dest: /etc/apache2/sites-available/owncloud.conf
    
- name: create link  
  file:
    src: /etc/apache2/sites-available/owncloud.conf
    dest: /etc/apache2/sites-enabled/owncloud.conf
    state: link
    
- name: get permission
  shell: chown -R www-data:www-data /var/www/owncloud/

- name: restart apache2
  systemd:
    name: apache2
    state: restarted
    
- name: occ - maintenance:install
  shell: sudo -u www-data php occ maintenance:install --database="Mysql" --database-name="owncloud" --database-host="localhost" --database-user="owncloud" --database-pass="dafeifei" --admin-user="owncloud" --admin-pass="dafeifei"
  args:
    chdir: /var/www/owncloud
    
- name: get my public IP
  ipify_facts:

# - name: set config
#   shell: sed -i "8c 0 => '{{ ipify_public_ip }}'," config/config.php
#   args:
#     chdir: /var/www/owncloud
- name: copying template file
  copy:
    src: templates/owncloud
    dest: /var/www/owncloud/config/config.php

# - name: create database for owncloud
#   mysql_dbï¼š
#     name: "{{ dbname }}"
#     login_host: "{{ hostname }}"
#     login_password: "{{ password }}"
#     login_user: "{{ username }}"
#     login_port: "{{ port }}"
#     state: present

  




# - name: run owncloud
#   shell: sudo bash owncloud_install.sh
